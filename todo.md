# Что в этой ветке

Планируется общий рефакторинг и исправление ошибок, без глобальных фичей и т.д.

Что будет:

- [x] Ошибка когда узел не коннектится к другому узлу - просто встает и все

Решения по факту нет - это проблема уже операционной системы.
Я не могу отследить когда запрос попадает в очередь запросов внутри ОС и следить за ходом его обработки,
поэтому задержки между отправкой запроса присоединения и фактическим принятием запроса - БУДУТ ВСЕГДА.

Но в рамках этой задачи был исправлен критический баг, из-за которого неправильно отслеживался терм у обработчика узлов
в
состоянии лидера - текущим термом считался ТЕКУЩИЙ терм узла, а не терм в котором вошли в состояние лидера.
Из-за этого возникали трудно воспроизводимые баги, когда узел падал без понятных на то причин.

- [x] Отслеживание лидера

Крч, починил тем, что IRaftConsensusModule теперь сам отслеживает лидера - не сторонний декоратор.
Обновляется при каждом успешном запросе к последователю (остальные состояния возвращают либо свой ID (лидер), либо
null (кандидат)).

Возникла другая проблема - ClusterOptions теперь зависит от этого модуля для своевременного получения лидера кластера и
когда реализовал
возникла циклическая зависимость. Решил тем, что убрал ClusterInfo из обязательных свойств IApplication - пока он никому
не нужен, так что не смертельно.

- [ ] Улучшенная обработка ошибок маппинга запросов на команды
- [ ] Stream для ISnapshot
- [ ] Рефакторинг стартапа (как ASP.NET Core) - регистрация сервисов, настройка конфигурации
- [ ] Логирование настроить
- [ ] Рефакторинг работы с диском (незакоммиченные записи на диске хранить)
- [ ] Таймаут ожидания при ошибке подключения к другому узлу (чтобы не спамил запросами)