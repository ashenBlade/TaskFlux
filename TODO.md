# Лист работ

Что хочу сделать?

## Баг с подключением узлов

Описание: при подключении узлов сейчас есть вероятность отправки ConnectResponse вместо AppendEntries или другое

Проблема решена так:

- Код логики tcp адаптера (реального) отрефакторил, там теперь немного чище
- Скорее всего проблема была из-за состояния гонки, поэтому просто сделал декоратор с `lock` - это ок, т.к. все вызовы
  синхронные
- Чтобы более гранулярно отслеживать токен отмены - в ожидании при потере соединения регистрирую cb на отмену токена где
  вызываю `Thread.Interrupt`

Еще:

- Отслеживать токен жизни состояния - прекращать отправку, если токен был отменен

## ID для записей

Описание: каждой записи назначать собственный ID для упрощения работы

Дополнительно:

- Можно использовать `ulong`
- Учитывать при восстановлении, вставке/удалении
- Скорее всего эту логику передать в объект очереди (хранит там что-то типа счетчика, а может и Guid рандомный)

Шаги реализации:

1. Добавить ID в `QueueRecord`
2. Хранение последнего ID в очереди
3. Добавить ID в интерфейс

## Блокирующее чтение

Выполнено

## Интерфейс файловой системы получше

Сейчас используются абстракции файловой системы из внешнего пакета, но мне нужны:

- `fdatasync`/`fsync`
- Сброс буферов для директорий (`fsync` на директорию)
