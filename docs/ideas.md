# Идеи для развития

В этом документе я буду писать все хотелки, идеи, заметки по поводу дальнейшей жизни проекта.

Заметки могут быть любого характера: функциональные или нефункциональные идеи, заметки по реализации (программирование) и всякое.

Каждую идею буду записывать сюда, чтобы не забыть.

## Паттерн мост для `IJobQueue`

### Статус

Идея

### Что

В `IJobQueue` сейчас только логика проверки максимальной длины.

Дальше будет хуже: FIFO или LIFO для одинаковых ключей, порядок ключей (Max или Min) и т.д.

Сейчас размер проверяется 2 разными классами, но пилить под каждый случай - такое себе.
Можно запилить много мостов (или стратегий). 

### Зачем

Функциональность расширяется и надо будет поддерживать много разных фич.
Делать подклассы для каждого случая - комбинаторный взрыв.

## Ограничение на размер тела

### Статус 

Идея

### Что

Надо сделать ограничение на размер тела, передаваемого с запросом.
Короче - ограничивать размер массива байт, хранящихся в каждом элементе очереди

### Зачем 

Большие буферы плохи:
- Большая нагрузка на память (если пулинг не сделать, но это другая история)
- Атака переполнением памяти
- Большой WAL (и запросы на другие узлы)

### Вопросы

Ограничение на все приложение, на каждую очередь отдельно или все вместе.

На все приложение:
- Можно делать проверку без необходимости клонирования команды в лог
- Но меньше гибкость

На каждую очередь:
- Нужно скопировать команду в лог и между приложениями (нагрузка на сеть + диск)
- Гибкость

Все вместе:
- Гибкость настройки (для каждой очереди)
- Можно проверить сразу
- Как они между собой взаимодействуют (можно ли если допустимый размер очереди больше, то как поступать? ошибка или приоритет?)


## Настройка очередности элементов в очереди

### Что 

Можно настраивать как элементы будут храниться в очереди в зависимости от ключа:
- Min или Max 
- Что при одинаковых ключах делать (FIFO, LIFO)

### Зачем 

Большая гибкость для прикладных приложений

### Как

Можно сделать через собственный сравнитель ключей `KeyComparer` для очереди.
Есть идея сделать 4 различных класса для каждого варианта:
- Min, FIFO
- Min, LIFO
- Max, FIFO
- Max, LIFO

Много классов, но:
- Скорость
- Вряд-ли изменится
- Писать нет ничего (разница в сравнениях)

# Файл лога с фиксированным размером

Когда создается новый файл лога, он должен сразу иметь максимальный размер.
Размер можно задавать в параметрах, например 16 Мб.

## Зачем

Не тратить лишнее время ОС на постоянное наращивание лога.
По возможности выделить непрерывный блок на диске.

## Как 

Размер лога можно указывать в конфигурации.
После создания снапшота нужно сделать новый файл лога - 
именно в этот момент создаем новый файл и увеличиваем его размер до требуемого.

