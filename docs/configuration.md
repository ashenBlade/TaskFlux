---
title: Конфигурация
---

В этой секции описываются способы конфигурирования приложения: поддерживаемые источники конфигурации, параметры, их
значения и названия аргументов.

# Источники конфигурации

На данный момент поддерживается 3 источника конфигурации.

Каждый параметр имеет свое название, но каждый источник конфигурации определяет свою конвенцию именования:

- Для JSON файла - Pascal Case
- Для переменных окружения - Screaming Snake Case
- Для аргументов командной строки - Kebab Case

Дальше, название каждого параметра будет указано в формате Pascal Case.

## Переменные окружения

Параметры передающиеся через переменные окружения имеют префикс `TASKFLUX_`.
Для именования используется стиль Screaming Snake Case.

Пример:

- `TASKFLUX_NODE_ID=1`
- `TASKFLUX_DATA_DIR=/var/lib/tflux`

## JSON файл

Приложение использует json файл `taskflux.settings.json`, который должен лежать в рабочей директории.
Файл не обязателен - если не будет найден, то работа продолжится.

Пример:

```json
{
    "NodeId": 1,
    "DataDir": "/var/lib/tflux"
}
```

## Аргументы командной строки

Аргументы командной строки - это параметры приложения, которые передаются на старте.
Названия аргументов должны начинаться с `--`.

Пример:

```shell
tflux --node-id 1 --data-dir /var/lib/tflux
```

# ID узла

| Название | Значение                    | Описание             | Значение по умолчанию | Обязателен |
|----------|-----------------------------|----------------------|-----------------------|------------|
| NodeId   | Целое неотрицательное число | ID запускаемого узла | ---                   | +          |

# Адреса узлов

Этот параметр содержит информацию об адресах других узлов кластера.

| Название | Значение                      | Описание             | Значение по умолчанию | Обязателен |
|----------|-------------------------------|----------------------|-----------------------|------------|
| Peers    | Массив адресов узлов кластера | ID запускаемого узла | ---                   | +          |

Для передачи массива каждый источник использует свой способ:

- JSON файл - JSON массив (пример, `"Peers": [...]`)
- Переменные окружения - каждый элемент передается через индекс в массиве с двойными `_` (
  пример, `PEERS__0`, `PEERS__1`)
- Аргументы командной строки - каждый элемент передается через индекс в массиве с двоеточием `:` (
  пример, `--peers:0`, `--peers:1`)

Каждый индекс соответствует ID узла в кластере. Необходимо передавать и адрес текущего узла.

# Порт запросов

| Название    | Значение                    | Описание                                          | Значение по умолчанию | Обязателен |
|-------------|-----------------------------|---------------------------------------------------|-----------------------|------------|
| ClusterPort | Целое неотрицательное число | Порт для приема запросов от других узлов кластера | 5000                  | -          |

# Адрес запросов

| Название    | Значение                | Описание                                                         | Значение по умолчанию | Обязателен | 
|-------------|-------------------------|------------------------------------------------------------------|-----------------------|------------|
| ClusterHost | DNS запись или IP адрес | Адрес, который будет прослушиваться для запросов от других узлов | 0.0.0.0               | -          |

# Порт для HTTP запросов

| Название | Значение                    | Описание                            | Значение по умолчанию | Обязателен | 
|----------|-----------------------------|-------------------------------------|-----------------------|------------|
| HttpPort | Целое неотрицательное число | Порт для запросов по HTTP протоколу | 1606                  | -          |

# Порт для TCP запросов от клиентов

| Название | Значение                    | Описание                                         | Значение по умолчанию | Обязателен | 
|----------|-----------------------------|--------------------------------------------------|-----------------------|------------|
| TcpPort  | Целое неотрицательное число | Порт для запросов по TCP протоколу (собственный) | 2606                  | -          |

# Адрес для директории с данными

| Название | Значение    | Описание                                           | Значение по умолчанию | Обязателен | 
|----------|-------------|----------------------------------------------------|-----------------------|------------|
| DataDir  | Строка пути | Путь до директории с данными для работы приложения | /var/lib/tflux        | +          |

# Мягкий предел файла сегмента

| Название         | Тип                         | Описание                                           | Значение по умолчанию | Обязателен |
|------------------|-----------------------------|----------------------------------------------------|-----------------------|------------|
| LogFileSoftLimit | Целое неотрицательное число | Мягкий предел размера файла сегмента лога в байтах | 16777216 (16 Мб)      | -          |

# Жесткий предел файла сегмента

| Название         | Тип                         | Описание                                            | Значение по умолчанию | Обязателен |
|------------------|-----------------------------|-----------------------------------------------------|-----------------------|------------|
| LogFileHardLimit | Целое неотрицательное число | Жесткий предел размера файла сегмента лога в байтах | 33554432 (32 Мб)      | -          |

# Количество сегментов для создания снапшота

| Название                          | Тип                         | Описание                                                                    | Значение по умолчанию | Обязателен |
|-----------------------------------|-----------------------------|-----------------------------------------------------------------------------|-----------------------|------------|
| SnapshotCreationSegmentsThreshold | Целое неотрицательное число | Количество закрытых сегментов, которое нужно создать, чтобы создать снашпот | 5                     | -          |

Этот параметр указывает на минимальное количество сегментов, которые полностью закоммичены, после достижения которого
будет создан снапшот.
При этом, покрываемые сегменты будут удалены.

# Дополнительно

## Текущие ограничения

На данный момент:

- Перечитывание конфигурации не поддерживается - для ее обновления нужно перезапускать приложение
- Неизвестные параметры будут проигнорированы

## Формат адреса

Сетевой адрес указывается в формате `хост[:порт]`, где:

- `хост` - адрес хоста узла. Может быть, как DNS записью, так и IP адресом;
- `порт` - номер порта узла. Если не указывается, то выставляется порт по умолчанию.

Как указывать:

- Переменные окружения: для каждого узла переменная в формате `PEERS__{ID}`, где заместо `ID` указать ID узла

> Адрес указывается для всех узлов кластера, даже для текущего узла.
> Например, если ID узла 1, то для него нужно указать параметры: `PEERS__0`, `PEERS__1`, `PEERS__2`.
