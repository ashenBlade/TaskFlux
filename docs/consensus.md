# Введение

`TaskFlux` использует алгоритм Raft для репликации.

Код для работы с ним лежит в папке `Consensus`.

На данный момент реализована только репликация.

# Структуры данных

## NodeId

Представляет собой ID узла.
По факту, псевдоним для `int` - работа с ним ведется так же.

## Term

Соответствует терму из Рафта.
Реализуется через `int`, но может принимать только положительные значения.

> Замечание: надо переделать под `uint` или `ulong` - зачем тратить дорогие биты?

# Снапшоттинг

Для оптимизации памяти Raft использует снапшоттинг - сброс на диск состояния машины с отбрасыванием части лога ей
соответствующей.

В `TaskFlux` снапшоты делаются при достижении определенного размера лога.
Максимальный размер лога указывается в конфигурации.

Снапшоты отправлются от лидера к последователю, когда лидер не имеет нужных записей лога.
Т.е. в обычной ситуации лидер всегда отправляет записи лога, за исключением моментов, когда
лидер сделал снапшот, удалил записи лога, а последователь требует удаленные записи.

В файле снапшота хранится все состояние системы (все очереди).

> TODO: лучше сделать разделение по очередям - на каждую очередь свой снапшот (и, соответственно, лог).
