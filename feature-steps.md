# Описание фичи

В текущей фиче планирую сделать механизм подтверждений чтения из очереди (при выполнении dequeue команды).
Когда пользователь прочитал из очереди он должен будет отправить ACK пакет (или типа того) и только тогда запись будет
удалена.

# Шаги

1. [x] Новый пакет для клиента - ACK

Этот пакет будет сигнализировать о том что команду можно реплицировать - типа коммит.
Нужно будет добавить описание в документацию (кто, когда и как ее использует) и сам пакет (+
сериализация/десериализация)

2. [x] Поменять логику с указанием команды как ReadOnly на флаг ShouldReplicate

Думаю, это лучше описывает логику работы, а не логику работы самой команды.
В частности - dequeue может быть и ReadOnly (когда нужно просто закомитить команду),
а может и нет (когда нужно действительно взять запись из очереди)

3. Разделение сериализации команды и записи лога

Крч, вместо сериализации самой команды теперь выделим отдельный тип - запись лога.
У CommandSerializer будет метод TryGetLogCommand (или типа того), который будет возвращать запись лога (если есть).
Если надо реплицировать - он вернет запись, иначе нет.

3. [ ] Обновление логики DequeueCommand

Теперь он должен не только исполнять команду, но и сохранять то, что получил - для сериализации в лог команд, когда
будем выполнять восстановление.
Плюсом ко всему, нужно отслеживать его состояние: новый, выполненный, вернуть данные и т.д.

4. [ ] Добавление логики обработки ACK на сторону сервера

Пока планирую сделать сам DequeueCommand умным - он сам будет отслеживать свое состояние (прочитал значение или нет).
Будет некая машина состояний.

5. [ ] Обновление логики работы обработчика запросов пользователей

Нужно добавить саму логику возвращения записи обратно в очередь:

- Таймаут
- Исключение какое-нибудь
- Пользователь закрыл соединение

И другие. - Крч, применять саму логику

6. [ ] Восстановление состояния из очереди умное

Теперь при восстановлении состояния нужно не просто создать очередь и пихать в нее записи,
а (условно) создавать множества элементов и поочередно выполнять нужные операции над ними - удаление/добавление/создание
и т.д.

Также нужно позаботиться о том, чтобы при становлении последователем состояние приложение стиралось,
а на лидере - восстанавливалось (иначе могут быть проблемы т.к. сначала команду выполняем и она может быть не
закомичена).